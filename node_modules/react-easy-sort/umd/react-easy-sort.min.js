!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("tslib"),require("array-move"),require("react")):"function"==typeof define&&define.amd?define(["exports","tslib","array-move","react"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).ReactEasySort={},e.tslib,e.arrayMove,e.React)}(this,(function(e,t,n,r){"use strict";function u(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var o=u(n),a=u(r),c=function(e,t,n){for(var r=e.x,u=e.y,o=(void 0===n?{}:n).fallbackToClosest,a=void 0!==o&&o,c=1e4,i=-1,l=0;l<t.length;l+=1){var f=t[l];if(r>=f.left&&r<f.right&&u>=f.top&&u<f.bottom)return l;if(a){var d=(f.left+f.right)/2,s=(f.top+f.bottom)/2,v=Math.sqrt(Math.pow(r-d,2)+Math.pow(u-s,2));v<c&&(c=v,i=l)}}return i},i=function(e){return{x:Number(e.clientX),y:Number(e.clientY)}},l=function(e){return{x:Number(e.clientX),y:Number(e.clientY)}},f=function(e,t){return{x:e.x-t.x,y:e.y-t.y}},d=function(e){e.preventDefault()},s=function(){window.removeEventListener("contextmenu",d)},v=function(e){var t=e.onStart,n=e.onMove,r=e.onEnd,u=e.containerRef,o=e.knobs,c=a.default.useRef({x:0,y:0}),v=a.default.useRef(void 0),m=a.default.useRef(!1),p=a.default.useRef({onStart:t,onMove:n,onEnd:r}),b=a.default.useState(!1),h=b[0],E=b[1];a.default.useEffect((function(){p.current={onStart:t,onMove:n,onEnd:r}}),[t,n,r]);var y=function(){v.current&&window.clearTimeout(v.current)},g=a.default.useCallback((function(){if(u.current){var e=u.current.getBoundingClientRect();c.current={x:e.left,y:e.top}}}),[u]),x=a.default.useCallback((function(e){var t=f(e,c.current);p.current.onMove&&p.current.onMove({pointInWindow:e,point:t})}),[]),C=a.default.useCallback((function(e){if(m.current){m.current=!1;var t=i(e),n=f(t,c.current);p.current.onStart&&p.current.onStart({point:n,pointInWindow:t})}else x(i(e))}),[x]),w=a.default.useCallback((function(e){e.cancelable?(e.preventDefault(),x(l(e.touches[0]))):(document.removeEventListener("touchmove",w),p.current.onEnd&&p.current.onEnd())}),[x]),L=a.default.useCallback((function(){m.current=!1,document.removeEventListener("mousemove",C),document.removeEventListener("mouseup",L),p.current.onEnd&&p.current.onEnd()}),[C]),R=a.default.useCallback((function(){document.removeEventListener("touchmove",w),document.removeEventListener("touchend",R),s(),p.current.onEnd&&p.current.onEnd()}),[w]),k=a.default.useCallback((function(e){0===e.button&&((null==o?void 0:o.length)&&!o.find((function(t){return t.contains(e.target)}))||(document.addEventListener("mousemove",C),document.addEventListener("mouseup",L),g(),m.current=!0))}),[C,L,g,o]),S=a.default.useCallback((function(e,t){document.addEventListener("touchmove",w,{capture:!1,passive:!1}),document.addEventListener("touchend",R),window.addEventListener("contextmenu",d,{capture:!0,passive:!1}),p.current.onStart&&p.current.onStart({point:e,pointInWindow:t})}),[R,w]),I=a.default.useCallback((function(e){if(!(null==o?void 0:o.length)||o.find((function(t){return t.contains(e.target)}))){g();var t=l(e.touches[0]),n=f(t,c.current);v.current=window.setTimeout((function(){return S(n,t)}),120)}}),[S,g,o]),M=a.default.useCallback((function(){E(!0),document.removeEventListener("touchstart",M)}),[]),_=a.default.useCallback((function(){y()}),[]);return a.default.useLayoutEffect((function(){if(h){var e=u.current;return null==e||e.addEventListener("touchstart",I,{capture:!0,passive:!1}),document.addEventListener("touchmove",_,{capture:!1,passive:!1}),document.addEventListener("touchend",_,{capture:!1,passive:!1}),function(){null==e||e.removeEventListener("touchstart",I),document.removeEventListener("touchmove",_),document.removeEventListener("touchend",_),document.removeEventListener("touchmove",w),document.removeEventListener("touchend",R),s(),y()}}return document.addEventListener("touchstart",M),function(){document.removeEventListener("touchstart",M),document.removeEventListener("mousemove",C),document.removeEventListener("mouseup",L)}}),[h,M,C,w,_,R,L,u,I]),h?{}:{onMouseDown:k}},m=a.default.createContext(void 0);e.SortableItem=function(e){var t=e.children,n=a.default.useContext(m);if(!n)throw new Error("SortableItem must be a child of SortableList");var r=n.registerItem,u=n.removeItem,o=a.default.useRef(null);return a.default.useEffect((function(){var e=o.current;return e&&r(e),function(){e&&u(e)}}),[r,u,t]),a.default.cloneElement(t,{ref:o})},e.SortableKnob=function(e){var t=e.children,n=a.default.useContext(m);if(!n)throw new Error("SortableKnob must be a child of SortableList");var r=n.registerKnob,u=n.removeKnob,o=a.default.useRef(null);return a.default.useEffect((function(){var e=o.current;return e&&r(e),function(){e&&u(e)}}),[r,u,t]),a.default.cloneElement(t,{ref:o})},e.default=function(e){var n=e.children,r=e.allowDrag,u=void 0===r||r,i=e.onSortEnd,l=e.draggedItemClassName,f=e.as,d=t.__rest(e,["children","allowDrag","onSortEnd","draggedItemClassName","as"]),s=a.default.useRef([]),p=a.default.useRef([]),b=a.default.useRef([]),h=a.default.useRef(null),E=a.default.useRef(null),y=a.default.useRef(void 0),g=a.default.useRef(void 0),x=a.default.useRef({x:0,y:0});a.default.useEffect((function(){return function(){E.current&&document.body.removeChild(E.current)}}),[]);var C=function(e){if(E.current){var t=x.current;E.current.style.transform="translate3d("+(e.x-t.x)+"px, "+(e.y-t.y)+"px, 0px)"}},w=a.default.useCallback((function(e){if(h.current){var t=s.current[e],n=p.current[e],r=t.cloneNode(!0);l&&l.split(" ").forEach((function(e){return r.classList.add(e)})),r.style.width=n.width+"px",r.style.height=n.height+"px",r.style.position="fixed",r.style.margin="0",r.style.top="0",r.style.left="0";var u=t.querySelectorAll("canvas");r.querySelectorAll("canvas").forEach((function(e,t){var n;null===(n=e.getContext("2d"))||void 0===n||n.drawImage(u[t],0,0)})),document.body.appendChild(r),E.current=r}}),[l]),L=v({containerRef:h,knobs:b.current,onStart:function(e){var t=e.pointInWindow;if(h.current){p.current=s.current.map((function(e){return e.getBoundingClientRect()}));var n=c(t,p.current);if(-1!==n){y.current=n,w(n);var r=s.current[n];r.style.opacity="0",r.style.visibility="hidden";var u=r.getBoundingClientRect();x.current={x:t.x-u.left,y:t.y-u.top},C(t),window.navigator.vibrate&&window.navigator.vibrate(100)}}},onMove:function(e){var t=e.pointInWindow;C(t);var n=y.current;if(void 0!==n){var r=c(t,p.current,{fallbackToClosest:!0});if(-1!==r){g.current=r;for(var u=n<r,o=0;o<s.current.length;o+=1){var a=s.current[o],i=p.current[o];if(u&&o>=n&&o<=r||!u&&o>=r&&o<=n){var l=p.current[u?o-1:o+1];if(l){var f=l.left-i.left,d=l.top-i.top;a.style.transform="translate3d("+f+"px, "+d+"px, 0px)"}}else a.style.transform="translate3d(0,0,0)";a.style.transitionDuration="300ms"}}}},onEnd:function(){for(var e=0;e<s.current.length;e+=1){var t=s.current[e];t.style.transform="",t.style.transitionDuration=""}var n=y.current;if(void 0!==n){var r=s.current[n];r&&(r.style.opacity="1",r.style.visibility="");var u=g.current;void 0!==u&&n!==u&&(s.current=o.default(s.current,n,u),i(n,u))}y.current=void 0,g.current=void 0,E.current&&(document.body.removeChild(E.current),E.current=null)}}),R=a.default.useCallback((function(e){s.current.push(e)}),[]),k=a.default.useCallback((function(e){var t=s.current.indexOf(e);-1!==t&&s.current.splice(t,1)}),[]),S=a.default.useCallback((function(e){b.current.push(e)}),[]),I=a.default.useCallback((function(e){var t=b.current.indexOf(e);-1!==t&&b.current.splice(t,1)}),[]),M=a.default.useMemo((function(){return{registerItem:R,removeItem:k,registerKnob:S,removeKnob:I}}),[R,k,S,I]);return a.default.createElement(f||"div",t.__assign(t.__assign(t.__assign({},u?L:{}),d),{ref:h}),a.default.createElement(m.Provider,{value:M},n))},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=react-easy-sort.min.js.map
